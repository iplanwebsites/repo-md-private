# Cloudflare Containers Configuration
# https://developers.cloudflare.com/containers/

name = "repo-build-worker-cf"
main = "src/cf-worker.ts"
compatibility_date = "2024-11-01"
compatibility_flags = ["nodejs_compat"]

# Container Configuration
[[containers]]
max_instances = 5
class_name = "RepoBuildContainer"
image = "./Dockerfile"

# Durable Object Bindings for Container Management
[[durable_objects.bindings]]
name = "BUILD_CONTAINER"
class_name = "RepoBuildContainer"

# Migrations for Durable Objects
[[migrations]]
tag = "v1"
new_sqlite_classes = ["RepoBuildContainer"]

# Environment Variables
[vars]
SKIP_EMBEDDINGS = "true"
SKIP_SQLITE = "true"
NODE_ENV = "production"
PORT = "8080"
TRANSFORMERS_OFFLINE = "1"
HF_HUB_OFFLINE = "1"

# Secrets (set with: wrangler secret put <NAME>)
# wrangler secret put WORKER_SECRET
# wrangler secret put GITHUB_TOKEN
# wrangler secret put OPENAI_API_KEY
# wrangler secret put R2_ACCESS_KEY_ID
# wrangler secret put R2_SECRET_ACCESS_KEY
# wrangler secret put R2_ACCOUNT_ID
# wrangler secret put R2_BUCKET_NAME

# Development Configuration
[dev]
port = 5522
local_protocol = "http"
